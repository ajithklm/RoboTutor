<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Automatic Hand Raising Gesture Detection by edwardelson</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Automatic Hand Raising Gesture Detection</h1>
        <p class="header">Research Internship at TU Delft Robotics Institute 2016</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/edwardelson/RoboTutor/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/edwardelson/RoboTutor/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/edwardelson/RoboTutor">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/edwardelson">edwardelson</a></p>


      </header>
      <section>
        <h1>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>INTRODUCTION</h1>

<p>These are the works that I did during my research internship project in the <a href="https://robotutor.weblog.tudelft.nl/">RoboTutor</a> team of <a href="http://robotics.tudelft.nl/">TU Delft Robotics Institute</a>. RoboTutor is a project that aims to use a Nao Robot to teach Robotics to students of schools in the Netherlands. Below is an image of RoboTutor in action, taken last year.  </p>

<p><img src="https://googledrive.com/host/0B3qXE5D5r-qCYzhBUF81cFN6Wlk/robotutor.jpg" alt="RoboTutor in Action">  </p>

<p>The main goal of my project is to detect hand-raising gestures in a video, and feed the coordinates of such gesture to the Nao Robot central processor. In the process, I tried out different methods as listed below:     </p>

<h3>
<a id="1-running-faster-r-cnn-algorithm-in-caffe-demo_robotutorpy" class="anchor" href="#1-running-faster-r-cnn-algorithm-in-caffe-demo_robotutorpy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(1) Running Faster R-CNN algorithm in Caffe (<a href="https://github.com/edwardelson/RoboTutor/blob/master/demo_robotutor.py">demo_robotutor.py</a>)</h3>

<p>During this period, Deep CNN was one of the state-of-the-art and the "hottest" method in the community. So Iinitially thought, why don't I try to adapt it for hand-raising gesture detection. So I forked <a href="https://github.com/rbgirshick/py-faster-rcnn">Ross Girshick's Faster R-CNN repo</a> and modify it so that it can run on video (initially it was only for image). After spending some time installing Caffe in my Ubuntu laptop, it runs quite well. However, as I can't use the GPU in my laptop (not enough memory), we installed a new computer in the <a href="http://www.insyghtlab.tudelft.nl/">INSYGHT lab</a> with GeForce GTX 680 GPU. The result can be seen in the following image.</p>

<h3>
<a id="2-transfer-learning-to-train-a-pre-existing-deep-cnn-for-self-crafted-hand-raising-images-robonetpy" class="anchor" href="#2-transfer-learning-to-train-a-pre-existing-deep-cnn-for-self-crafted-hand-raising-images-robonetpy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(2) Transfer Learning to train a Pre-existing Deep CNN for self-crafted hand-raising images (<a href="https://github.com/edwardelson/RoboTutor/blob/master/robonet.py">robonet.py</a>)</h3>

<p>The next step is to train Faster R-CNN for a new dataset of handraising gestures that it has not seen before. Faster R-CNN consists of several stages: Region Proposal Network, Convolutional Layers and Classification Network. In this step, I focused more on the Convolutional Layers and Classification Network. I figured out that these layers were actually a result of transfer learning from another existing deep networks. So I went to <a href="https://github.com/BVLC/caffe/wiki/Model-Zoo">Caffe Model Zoo</a>, and browse for some existing pretrained networks. As a preliminary test, I chose the <a href="http://caffe.berkeleyvision.org/gathered/examples/finetune_flickr_style.html">Flickr model</a> as there's an existing tutorial from Caffe on how to dissect and retrain it.  </p>

<p>Another problem is that there's no existing dataset on hand-raising gesture images. So I decided to try crafting our own dataset from scratch. I experimented with very small size of dataset (about the size of 20 images). I then train the network for this dataset.</p>

<p>The result is of course very fast convergence, with 100% training data accuracy. This is absolutely an overfit, and when tested with a new image it has never seen, it performs almost no better than chance. We are left with the option of enlarging the dataset (which takes a lot of time) or try out another method. </p>

<p><img src="https://googledrive.com/host/0B3qXE5D5r-qCYzhBUF81cFN6Wlk/robonet.jpeg" alt="Resulting Image demo Faster R-CNN">   </p>

<p>Left image is a sample dataset, Right image is the python code that I ran.    </p>

<h3>
<a id="3-haar-feature-approach-for-face--hand-detection-haar_handraise_detectionpy" class="anchor" href="#3-haar-feature-approach-for-face--hand-detection-haar_handraise_detectionpy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(3) Haar Feature Approach for Face + Hand Detection (<a href="https://github.com/edwardelson/RoboTutor/blob/master/haar_handraise_detection.py">haar_handraise_detection.py</a>)</h3>

<p>I was inspired by a paper which tries to tackle this problem by detecting face and hand separately. I borrowed this idea and decide to find the Euclidean distance between detected faces and hands to decide whether a hand-raising gesture exists. I experimented with Haar Feature with Skin Detection (preliminary elimination of non-skin objects). The result can be seen below.   </p>

<p><img src="https://googledrive.com/host/0B3qXE5D5r-qCYzhBUF81cFN6Wlk/raw_norm.jpeg" alt="Normal Raw Image">  </p>

<p><img src="https://googledrive.com/host/0B3qXE5D5r-qCYzhBUF81cFN6Wlk/mask_norm.jpeg" alt="Normal with Skin Detected Image">  </p>

<p><img src="https://googledrive.com/host/0B3qXE5D5r-qCYzhBUF81cFN6Wlk/raw.jpeg" alt="Hand-raising Gesture Detected in Raw Image">  </p>

<p><img src="https://googledrive.com/host/0B3qXE5D5r-qCYzhBUF81cFN6Wlk/mask.jpeg" alt="Hand-raising Gesture Detected in Skin Detected Image">     </p>

<p>A similar result can also be seen in the following <a href="https://www.youtube.com/watch?v=Lps8rkGjzvY&amp;feature=youtu.be">video</a> that I've made.   </p>

<p>I wanted to use the same idea, but now using Faster R-CNN to train and detect face and hand, hence combining step 1-3. However, I did not have enough time as my Student Exchange Period is ending soon. So I stopped at this stage and proceed to implement the Java wrapper for the code. This is to allow the Nao robot to use this module. The current result is far from perfect (especially in noisy environment), but it can roughly point out the location of hand raising gestures in a classroom setting. I believe that the usage of CNN will yield a better result (more accurate detection of hand and face).   </p>

<h3>
<a id="4-implementing-java-wrapper-for-python-code-to-fit-into-the-nao-system-to-be-updated" class="anchor" href="#4-implementing-java-wrapper-for-python-code-to-fit-into-the-nao-system-to-be-updated" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(4) Implementing Java Wrapper for Python code to fit into the Nao system (to be updated)</h3>

<p>This work is under progress.  </p>

<blockquote>
<p><a href="https://edwardelson.github.io">Back to List of Projects</a>  </p>
</blockquote>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
